<!--
  Title: index.html
  Summary: babylon.js driver html file for tutorials and the bjs_test video
  Owner: Zachary Fout
  Version: 0.0.1
  Created: 06/20/2016
  Last Modified: 06/21/2016
  Notes: completed basic scene tutorial
-->
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html" charset="utf-8" />
    <title>Babylon - Getting Started</title>
    <!-- link to the latest version of babylon -->
    <script src="./js/babylon.2.4.js"></script>
    <script src="./js/hand.1.2.js"></script>
    <script src="./js/cannon.2.4.js"></script>
    <script src="./js/oimo.2.4.js"></script>
    <style>
      html, body {
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      } #renderCanvas {
        width: 100%;
        height: 100%;
        touch-action: none;
      }
    </style>
  </head>
  <body>
    <canvas id="renderCanvas"></canvas>
    <script>
      window.addEventListener('DOMContentLoaded', function() {
        // get a reference to the canvas DOM element
        var canvas = document.getElementById('renderCanvas');

        // load the Babylon 3D engine
        var engine = new BABYLON.Engine(canvas, true);

        // create and return a babylon scene
        var createScene = function () {
          var scene = new BABYLON.Scene(engine);

	        scene.enablePhysics(new BABYLON.Vector3(0, -10, 0), BABYLON.OimoJSPlugin());

          // Lights
	        // var light = new BABYLON.HemisphericLight("hemi", new BABYLON.Vector3(0, 1, 0), scene);
          var light0 = new BABYLON.DirectionalLight("Omni", new BABYLON.Vector3(-2, -5, 2), scene);
          //var light1 = new BABYLON.PointLight("Omni", new BABYLON.Vector3(2, -5, -2), scene);

	        // camera directly above ground
	        /* var camera = new BABYLON.FreeCamera("FreeCamera", new BABYLON.Vector3(0, 200, 0), scene);
	        camera.rotation = new BABYLON.Vector3(Math.PI / 2, 0, 0);
          camera.attachControl(canvas, true); */

          // final camera position
          var camera = new BABYLON.FreeCamera("FreeCamera", new BABYLON.Vector3(0, 100, -300), scene);
	        camera.rotation = new BABYLON.Vector3(.4, 0, 0);
          camera.attachControl(canvas, true);

	        // Ground
	        var ground = BABYLON.Mesh.CreatePlane("ground", 120.0, scene);
	        ground.material = new BABYLON.StandardMaterial("groundMat", scene);
	        ground.material.diffuseColor = new BABYLON.Color3(0.7, 0.7, 0.7);
	        ground.material.backFaceCulling = false;
	        ground.rotation = new BABYLON.Vector3(Math.PI / 2, 0, 0);
	        ground.setPhysicsState(BABYLON.PhysicsEngine.BoxImpostor, { mass: 0, friction: 0.5, restitution: 0.7 });
	        ground.updatePhysicsBodyPosition();
	        // ground.rotation = new BABYLON.Vector3(Math.PI / 2, -Math.PI / 32, 0);

	        // center sphere
	        var sphere = BABYLON.Mesh.CreateSphere("sphere", 20.0, 15.0, scene, true);
	        sphere.position.y = 10;

	        var boxes = [];

	        for (var i = 0; i < 12; ++i) {
		        var box = BABYLON.Mesh.CreateBox("box" + i, 10, scene);
		        box.material = new BABYLON.StandardMaterial("box" + i + "Mat", scene);
		        box.material.diffuseColor = new BABYLON.Color3(1, 0, 0);
		        box.position = new BABYLON.Vector3(40 * Math.cos(i * Math.PI / 6), 80, 40 * Math.sin(i * Math.PI / 6));
		        box.setPhysicsState(BABYLON.PhysicsEngine.BoxImpostor, { mass: 1, friction: 0.5, restitution: 0.7 });
		        boxes.push(box);
          }

	        // set the gravity for the scene
	        scene.gravity = new BABYLON.Vector3(0, -0.981, 0);

	        // Enable Collisions
          scene.collisionsEnabled = true;

	        for (var i = 0; i < boxes.length; ++i) {
		        boxes[i].checkCollisions = true;
	        }
	        ground.checkCollisions = true;

          return scene;
        };

        // call the createScene function
        var scene = createScene();

        // run the render loop
        engine.runRenderLoop(function() {
          scene.render();
        });

        // event handler for canvas/window resizing
        window.addEventListener('resize', function() {
          engine.resize();
        });
      });
    </script>
  </body>
</html>
